jobs:
  convert-markdown-to-pdf:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Pandoc, LaTeX, and Fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-xetex texlive-fonts-recommended texlive-latex-recommended fonts-dejavu

      - name: Find Markdown files
        id: find_markdown
        run: |
          files=$(find . -name "*.md" | tr '\n' ' ')
          echo "markdown_files=$files" >> $GITHUB_ENV

      - name: Debug: Print Working Directory
        run: pwd

      - name: Debug: List Files
        run: ls -R

      - name: Convert Markdown to PDF
        if: env.markdown_files != ''
        run: |
          for file in $markdown_files; do
            pandoc "$file" -o "$(pwd)/${file%.md}.pdf" --pdf-engine=xelatex
          done

      - name: Rename CV.pdf
        if: env.markdown_files != ''
        run: |
          if [ -f "$(pwd)/CV.pdf" ]; then
            today=$(date +%Y%m%d)
            mv "$(pwd)/CV.pdf" "$(pwd)/MorganSziraki_CV_${today}_4pg.pdf"
          else
            echo "CV.pdf not found!"
          fi

      - name: Upload PDFs as artifacts
        uses: actions/upload-artifact@v3
        with:
          name: converted-pdfs
          path: "$(pwd)/*.pdf"


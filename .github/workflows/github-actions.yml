jobs:
  convert-markdown-to-pdf:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Install Pandoc, LaTeX, and Fonts
      - name: Install Pandoc, LaTeX, and Fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-xetex texlive-fonts-recommended texlive-latex-recommended fonts-dejavu

      # Step 3: Find Markdown files
      - name: Find Markdown files
        id: find_markdown
        run: |
          files=$(find . -name "*.md")
          echo "markdown_files=$files" >> $GITHUB_ENV

      # Step 5: Debug - Print the working directory
      - name: Debug: Print Working Directory
        run: pwd

      # Step 6: Debug - List all files recursively
      - name: Debug: List Files
        run: ls -R

      # Step 7: Convert Markdown to PDF
      - name: Convert Markdown to PDF
        if: ${{ env.markdown_files != '' }}
        run: |
          # Loop through each Markdown file
          for file in ${{ env.markdown_files }}; do
            echo "Processing $file"
            pandoc "$file" -o "$(pwd)/${file%.md}.pdf" --pdf-engine=xelatex
          done

      # Step 8: Rename CV.pdf to include today's date
      - name: Rename CV.pdf
        if: ${{ env.markdown_files != '' }}
        run: |
          if [ -f "$(pwd)/CV.pdf" ]; then
            today=$(date +%Y%m%d)
            mv "$(pwd)/CV.pdf" "$(pwd)/MorganSziraki_CV_${today}_4pg.pdf"
          else
            echo "CV.pdf not found!"
          fi

      # Step 9: Upload PDFs as artifacts
      - name: Upload PDFs as artifacts
        uses: actions/upload-artifact@v3
        with:
          name: converted-pdfs
          path: "$(pwd)/*.pdf"

name: Convert Markdown to PDF

on:
  push:
    paths:
      - "**/*.md" # Trigger only when Markdown files are modified or pushed
  workflow_dispatch: # Allow manual triggering of the workflow

jobs:
  convert-markdown-to-pdf:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Install necessary tools
      - name: Install Pandoc, LaTeX, and Fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-xetex texlive-fonts-recommended texlive-latex-recommended fonts-dejavu

      # Find Markdown files
      - name: Find Markdown files
        id: find_markdown
        run: |
          files=$(find . -name "*.md")
          echo "markdown_files=$files" >> $GITHUB_ENV

      # Clean Markdown files (optional: remove problematic Unicode characters)
      - name: Preprocess Markdown files
        if: env.markdown_files
        run: |
          for file in $markdown_files; do
            sed -i 's/â– /-/g' "$file" # Replace problematic character
          done

      # Convert Markdown to PDF
      - name: Convert Markdown to PDF
        if: env.markdown_files
        run: |
          for file in $markdown_files; do
            pandoc "$file" -o "${file%.md}.pdf" --pdf-engine=xelatex
          done

      # Rename CV.pdf with the current date
      - name: Rename CV.pdf
        if: env.markdown_files
        run: |
          if [ -f CV.pdf ]; then
            today=$(date +%Y%m%d)
            mv CV.pdf "MorganSziraki_CV_${today}_4pg.pdf"
          fi

      # Upload PDFs as artifacts
      - name: Upload PDFs as artifacts
        uses: actions/upload-artifact@v3
        with:
          name: converted-pdfs
          path: "**/*.pdf"

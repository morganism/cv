name: Convert Markdown to PDF

on:
  push:
    paths:
      - '**/*.md'  # Trigger on changes to any Markdown file in the repository named CV.md

on:
  push:
    paths:
      - 'CV.md'  # Trigger only when CV.md is modified
  workflow_dispatch:  # Allow manual triggering of the workflow

jobs:
  convert-markdown-to-pdf:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Install Pandoc, LaTeX, and Fonts
      - name: Install Pandoc, LaTeX, and Fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-xetex texlive-fonts-recommended texlive-latex-recommended fonts-dejavu

      # Step 3: Debug - Check for CV.md
      - name: Debug Check for CV.md
        run: |
          if [ -f "CV.md" ]; then
            echo "CV.md exists!"
          else
            echo "CV.md not found!"
            exit 1
          fi

      # Step 4: Convert CV.md to PDF
      - name: Convert CV.md to PDF
        run: |
          pandoc CV.md -o CV.pdf --pdf-engine=xelatex

      # Step 5: Rename PDF
      - name: Rename CV.pdf
        run: |
          if [ -f "CV.pdf" ]; then
            today=$(date +%Y%m%d)
            mv CV.pdf "MorganSziraki_CV_${today}_4pg.pdf"
          else
            echo "CV.pdf not found!"
            exit 1
          fi

      # Step 6: Upload PDF as artifact
      - name: Upload PDF
        uses: actions/upload-artifact@v3
        with:
          name: CV-PDF
          path: MorganSziraki_CV_*.pdf

jobs:
  convert-markdown-to-pdf:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Install Pandoc, LaTeX, and Fonts
      - name: Install Pandoc, LaTeX, and Fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-xetex texlive-fonts-recommended texlive-latex-recommended fonts-dejavu

      # Step 3: Find Markdown files
      - name: Find Markdown files
        id: find_markdown
        run: |
          files=$(find . -name "*.md")
          echo "markdown_files=$files" >> $GITHUB_ENV

      # Step 4: Convert Markdown to PDF
      - name: Convert Markdown to PDF
        if: ${{ env.markdown_files != '' }}
        run: |
          # Loop through each Markdown file
          for file in ${{ env.markdown_files }}; do
            echo "Processing $file"
            pandoc "$file" -o "$(pwd)/${file%.md}.pdf" --pdf-engine=xelatex
          done

      # Step 5: Rename CV.pdf to include today's date
      - name: Rename CV.pdf
        if: ${{ env.markdown_files != '' }}
        run: |
          if [ -f "$(pwd)/CV.pdf" ]; then
            today=$(date +%Y%m%d)
            mv "$(pwd)/CV.pdf" "$(pwd)/MorganSziraki_CV_${today}_4pg.pdf"
          else
            echo "CV.pdf not found!"
          fi

      # Step 6: Upload PDFs as artifacts
      - name: Upload PDFs as artifacts
        uses: actions/upload-artifact@v3
        with:
          name: converted-pdfs
          path: "$(pwd)/*.pdf"
